<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../../favicon.ico">
  {% load staticfiles %}
  <title>云共享平台</title>
</head>

<body>
  <!--================================================here is the message block=======================================================-->
  <div class="container-fluid" >
    <div id="toolbar" class="btn-group table-control tool-control">
      <button type="button" class="btn btn-default" id="healtheradd">   <!--data-target="#myModal" data-toggle="modal"  想要调出上面的弹窗就用这几个属性-->
        <i class="glyphicon glyphicon-plus"></i>
      </button>
      <button type="button" class="btn btn-default" id="healtheredit">
        <i class="glyphicon glyphicon-edit"></i>
      </button>
      <button type="button" class="btn btn-default" id="healtherdelete">
        <i class="glyphicon glyphicon-trash"></i>
      </button>
    </div>
    <!--   ================================================the table======================================================== -->
    <div class="col-md-12 table-control" style="margin-left:-3%; margin-top: -2%"; id="table">
{#       <div id="filter-bar"></div>#}
      <table data-show-filter="true"  data-toggle="table" id="healther" data-height="520"  data-search="true" data-show-refresh="true" data-show-toggle="true" data-show-columns="true" data-toolbar="#toolbar"  >
        <thead>
         <tr>
          <th></th>
        </tr>
        </thead>
      </table>
    </div>  <!--col-md-12-->
{#    <div class="container" style="display: none;" id="healtheraddpanel">#}
{#      <div class="alert alert-danger" role="alert" style="margin-left: -1%; display: none" id="alert"></div>#}
      <div class="row" style="margin-left: -2% ;display: none" id="healtheraddpanel" >
        <div class="col-md-12">
          <div class="panel panel-success">
            <div class="panel-heading">
              <h4 class="panel-title" id="changepanel">健康用户添加</h4>
            </div>
              <form id="healtherform" method="post" >
                <div id="validateform">
                  <div class="panel-body">
                      <div class="row">
                      <div class="col-md-5">
                        <div class="form-group hidden">
                            <label for="UserID">用户ID</label>
                            <input type="text" class="form-control" id="UserID" name="userid"  style=" width:100%"  disabled="true">
                        </div>
                        <div class="form-group">
                          <label for="UserName" class="control-label">用户名</label>
                            <input type="text" class="form-control" id="UserName" name="username"  style=" width:100%" required>
                        </div>
{#                        <div class="form-group">#}
{#                          <label for="Last_Login" class="control-label">最后登录</label>#}
{#                            <input type="text" class="form-control" id="Last_Login" name="last_login"  style=" width:100%" disabled="true" required>#}
{#                        </div>#}
                        <div class="form-group">
                          <label for="Password">密码</label>
                          <input type="password" class="form-control" id="Password" name="password" placeholder="Password" style="width:100%" required>
                        </div>
                        <div class="form-group">
                          <label for="UserAge">用户年龄</label>
                          <input type="text" class="form-control" id="UserAge" name="userage" placeholder="UserAge" style="width:100%" required>
                        </div>
                        <div class="form-group">
                          <label for="UserRank">用户等级</label>
                          <select class="form-control" id="UserRank" name="userrank" required>
                            <option value ="1">1</option>
                            <option value ="2">2</option>
                            <option value ="3">3</option>
                            <option value ="4">4</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label for="temp_SleepFeatureID">睡眠特征ID</label>
                          <select class="form-control" id="temp_SleepFeatureID" name="temp_sleepfeatureid" required>
                              <option value selected>请选择</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label for="temp_ExerciseFeatureID">运动特征ID</label>
                          <select class="form-control" id="temp_ExerciseFeatureID" name="temp_exercisefeatureid" required>
                              <option>请选择</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label for="Is_Admin" style="width:100px">是否是管理员</label>
                          <input type="text" class="form-control" id="is_admin" name="is_admin" style="width:100%" required>
                        </div>
                      </div> <!--cil-md-5 -->
                      <div class="col-md-1"></div>
                      <div class="col-md-5">
                        <div class="form-group">
                          <label for="Name" class="control-label">用户姓名</label>
                            <input type="text" class="form-control" id="Name" name="name"  style=" width:100%" required>
                        </div>
                        <div class="form-group">
                          <label for="email">邮箱</label>
                          <div class="form-group">
                            <div class="input-group">
                              <label class="sr-only" for="email">Email address</label>
                              <div class="input-group-addon">@</div>
                              <input type="email" class="form-control" id="email" name="email"  style="width:100%" required>
                            </div>
                          </div>
                        </div>
                        <div class="form-group">
                          <label for="UserWorkType" style="width:100px">用户工作类型</label>
                          <input type="text" class="form-control" id="UserWorkType" name="userwroktype" placeholder="UserWorkType" style="width:100%" required>
                        </div>
                        <div class="form-group">
                          <label for="UserBMIindex" style="width:100px">用户BMI指数</label>
                          <input type="text" class="form-control" id="UserBMIindex" name="userbmiindex" placeholder="体质指数（BMI）=体重（kg）÷身高^2（m）" style="width:100%" required>
                        </div>
                        <div class="form-group">
                          <label for="PhoneNumber" style="width:100px">手机号</label>
                          <input type="text" class="form-control" id="PhoneNumber" name="userphonenumber" placeholder="PhoneNumber" style="width:100%" required>
                        </div>
                        <div class="form-group">
                          <label for="temp_EatingFeatureID">饮食特征ID</label>
                          <select class="form-control" id="temp_EatingFeatureID" name="temp_eatingfeatureid" required>
                              <option>请选择</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label for="temp_AdminisAreaID">行政区划ID</label>
                          <select class="form-control" id="temp_AdminisAreaID" name="temp_adminisareaid" required>
                              <option>请选择</option>
                          </select>
                        </div>
                        <br/>
                        <div class="form-group">
                          <label for="usersex2">用户性别</label>&nbsp;&nbsp;&nbsp;
                          <label class="radio-inline">
                            <input type="radio" name="usersex" value="男" id="nan">男
                          </label>
                          <label class="radio-inline">
                            <input type="radio" name="usersex" value="女" id="nv">女
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="panel-footer">
                    <div class="row">
                      <div class="col-md-1 col-md-offset-7 col-lg-1 col-lg-offset-10">
                        <button type="button" class="btn btn-primary" style="margin-top:5px" id="cancel">取消</button>
                      </div>
                      <div class="col-md-1">
                        <button type="submit" class="btn btn-success" style="margin-top:5px" id="doit">创建</button>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
          </div>
        </div>
      </div>
{#    </div>  <!--container-fluid-->#}
  </div>  <!--container-fluid-->
<!--=========================================here is the js file================================================================-->
  {% load staticfiles %}
  <script src="{% static "login/static/js/start.js" %}"></script>
<script>
  var rowcontent = null;
  var tag = null;
  //点击添加按钮，表格消失，添加界面显示
  $('#healtheradd').click(function(){
    tag ="add";
    $('#table').css('display','none');
    $('#healtheraddpanel').css('display','block');
  });
  $("form").submit(function(e){
        e.preventDefault();
    });
  //点击编辑按钮，把获取到的json 填充到添加界面中
  $('#healtheredit').click(function(){
      tag = "edit";
      var jsonobject = eval('('+ rowcontent +')');
      $('#UserID').val(jsonobject.userid);
      $('#UserName').val(jsonobject.username);
    if(jsonobject.usersex.toString() == "女"){
        $("#nv").attr("checked","true")
    }else {
        $("#nan").attr("checked", "true")
    };
     $('#Password').val(jsonobject.password);
     $('#UserAge').val(jsonobject.userage);
     $('#UserWorkType').val(jsonobject.userwroktype);
     $('#PhoneNumber').val(jsonobject.userphonenumber);
     $('#UserBMIindex').val(jsonobject.userbmiindex);
     $('#email').val(jsonobject.email);
     $('#Name').val(jsonobject.name);
{#     $('#Last_Login').val(jsonobject.last_login);#}
      $('#Is_Admin').val(jsonobject.is_admin);
     $('#UserRank').val(jsonobject.userrank);
     $('#temp_SleepFeatureID').val(jsonobject.temp_sleepfeatureid);
     $('#temp_ExerciseFeatureID').val(jsonobject.temp_exercisefeatureid);
     $('#temp_EatingFeatureID').val(jsonobject.temp_eatingfeatureid);
     $('#temp_AdminisAreaID').val(jsonobject.temp_adminisareaid);

     $('#toolbar').css('display','none');
     $('#table').css('display','none');
     $('#healtheraddpanel').css('display','block');
     $('#changepanel').html("普通用户编辑");
     $('#doit').html("确定");
  });
  $('#healther').on('check.bs.table', function(e,row){
    rowcontent = JSON.stringify(row);  //把json对象解析成string对象
  });
  //点加取消按钮，直接回到表格界面
  $('#cancel').click(function(){
        turnPage('back/dashboard/main/healther.html');
    });
    $('#doit').click(function(){
        var jsonobject = eval('('+ rowcontent +')');
        var jsonobj1 = {};
        var jsonObject = $('#healtherform').serializeArray();
        $.each(jsonObject, function(){
            if(jsonobj1[this.name]){
                if(!jsonobj1.push){
                    jsonobj1[this.name] = [jsonobj1[this.name]];
                }
                jsonobj1[this.name].push(this.value || '');
            }else{
                jsonobj1[this.name] = this.value || '';
            }
        });
        if(tag == "add"){
             $.ajax({
                async:false,
                type: "post",
                dataType:'json',
                data:jsonobj1,
                url:baseAddress+'/tbuser/',
                success:function(data){
                    turnPage('back/dashboard/main/healther.html');
                },
                error:function(json){
                    alert ("插入失败");
                    $('.table-control').css('display','none');
                    $('#healtheraddpanel').css('display','block');
                }
            });
        }else{
            alert(jsonobject.userid);
            $.ajax({
                async:false,
                type: "patch",
                dataType:'json',
                data:jsonobj1,
                url: baseAddress+'/tbuser/'+jsonobject.userid+"/",
                success:function(data){
                    turnPage('back/dashboard/main/healther.html');
                },
                error:function(json){
                    alert ("修改失败");
                    $('.table-control').css('display','none');
                    $('#healtheraddpanel').css('display','block');
                }
            });
        }
    });
       //删除
    $('#healtherdelete').click(function(){
            var jsonobject = eval('('+ rowcontent +')');
           if(confirm("是否删除此条信息？")) {
               $.ajax({
                   type: 'delete',
                   url: baseAddress+'/tbuser/'+jsonobject.userid+"/",
                   success: function (json) {
                       turnPage('back/dashboard/main/healther.html');
                   },
                   error: function(){
                       alert("wrong");
                   }
               })
           }
       });

    //获取行政id数据
    jQuery(function($){
        $.ajax({
            type: "get",
            datatype:"json",
            url:baseAddress+'/tbadminisarea/',
            success:function(msg){
                var str="";
                for(i in msg){
                    str += "<option value ="+ msg[i].adminisareaid+" >" + msg[i].adminisarearemarks + "</option>";
                }
                $("#temp_AdminisAreaID").append(str);
            }
        })
    });
   //获取睡眠特征id数据
    jQuery(function($){
        $.ajax({
            type: "get",
            datatype:"json",
            url:baseAddress+'/tbusersleepfeature/',
            success:function(msg){
                var str="";
                for(i in msg){
                    str += "<option value ="+ msg[i].sleepfeatureid+" >" + msg[i].bedtimehabits + "</option>";
                }
                $("#temp_SleepFeatureID").append(str);
            }
        })
    });
     //获取运动特征id数据
    jQuery(function($){
        $.ajax({
            type: "get",
            datatype:"json",
            url:baseAddress+'/tbuserexercisefeature/',
            success:function(msg){
                var str="";
                for(i in msg){
                    str += "<option value ="+ msg[i].exercisefeatureid+" >" + msg[i].bedtimehabits + "</option>";
                }
                $("#temp_ExerciseFeatureID").append(str);
            }
        })
    });
     //获取饮食特征id数据
    jQuery(function($){
        $.ajax({
            type: "get",
            datatype:"json",
            url:baseAddress+'/tbfoodfeature/',
            success:function(msg){
                var str="";
                for(i in msg){
                    str += "<option value ="+ msg[i].eatingfeatureid+" >" + msg[i].eatinghabitanalysis + "</option>";
                }
                $("#temp_EatingFeatureID").append(str);
            }
        })
    });


  $(function(){
      //过滤器
      $('#filter-bar').bootstrapTableFilter({
            filters:[
                {
                    field: 'username',    // field identifier
                    label: '用户名',    // filter label
                    type: 'search'   // filter type
                },
                {
                    field: 'usersex',
                    label: '用户性别',
                    type: 'select',
                    values: [
                        {id: '男', label: '男'},
                        {id: '女', label: '女'},
                    ]
                },
                {
                    field: 'userage',
                    label: '用户年龄',
                    type: 'range'
                },
                {
                    field: 'userrank',
                    label: '用户等级',
                    type: 'search'
                }
            ],
            onSubmit: function() {
                var data = $('#filter-bar').bootstrapTableFilter('getData');
{#                console.log(data);#}
                alert(data);
            }
        });
       window.parent.frames.bottom.location.reload();

    $('#validateform').bootstrapValidator({
      excluded: ':disabled',
      feedbackIcons: {
        valid: 'glyphicon glyphicon-ok',
        invalid: 'glyphicon glyphicon-remove',
        validating: 'glyphicon glyphicon-refresh'
      },

      fields: {
          username: {
              validators: {
                  regexp: {
                      regexp: /^[\u4e00-\u9fa5]+$/,
                      message: '用户名只能包含中文'
                  },
                  stringLength: {
                      max: 30,
                      message: '请将用户名限制在30个字符以内'
                  }
              }
          },
          userphonenumber: {
              validators: {
                  regexp: {
                      regexp: /^1[3|4|5|8][0-9]\d{4,8}$/,
                      message: '不是完整的11位手机号或者正确的手机号前七位'
                  }
              }
          },
          userbmiindex: {
              validators: {
                  regexp: {
                      regexp: /^\d{1,6}(\.\d{1,2})$/,
                      message: '限制最多六位整数以及两位小数'
                  }
              }
          },
          userage: {
              validators: {
                  regexp: {
                      regexp: /^[1-9]\d?$|^1[01]\d$|^120$/,
                      message: '年龄1-120岁之间'
                  }
              }
          },
          userpassword: {
              validators: {
                  regexp: {
                      regexp: /^[a-zA-Z0-9_]+$/i,
                      message: '密码只能包含字母 数字 下划线'
                  },
                  stringLength: {
                      min: 6,
                      max: 30,
                      message: '请将密码限制在6-30个字符以内'
                  }
              }
          }
      }
    });
  });
</script>


</body>
</html>


